import{_ as $,v as W,Y as H,g as N,r as S,c as y,b as g,e as l,x as K,t as v,d as o,u as s,l as P,w as n,f as p,j as m,E as b,h as Q,I as f,n as j,J as Y,F as G,p as X,y as Z,K as A}from"./index-DeY1YHTF.js";import{u as ee}from"./userStore-COGniEOj.js";import{i as le}from"./request-AGTuPeZF.js";const ae={class:"users-page"},te={class:"header-row"},se={class:"page-title"},oe={class:"header-actions"},de={class:"filter-section"},re={class:"name-with-status"},ie={class:"locker-location-cell"},ce={class:"user-cards mobile-cards"},ne={class:"card-row data-row"},ve={class:"card-cell"},ue={class:"cell-value name-with-status"},pe={class:"card-cell"},me={class:"cell-value"},fe={class:"card-row data-row"},ge={class:"card-cell"},ye={class:"cell-value"},be={class:"card-cell"},he={class:"cell-value locker-location-cell"},_e={class:"card-row data-row"},we={class:"card-cell"},ke={class:"cell-value"},Ce={class:"card-cell"},Se={class:"cell-value"},Ae={class:"card-row data-row"},Ie={class:"card-cell action-cell",style:{"grid-column":"1 / -1"}},Ee={class:"cell-value"},xe=Object.assign({name:"Users"},{__name:"Users",setup(Le){const k=W(),C=ee(),B=H(),O=N(()=>C.userList),h=S(""),_=S(""),D={backgroundColor:"#0a1929",color:"#00d4ff",fontWeight:"600"},w=N(()=>{let t=[...O.value];if(_.value&&(t=t.filter(e=>e.category===_.value)),h.value){const e=h.value.toLowerCase();t=t.filter(a=>Object.entries(a).some(([i,d])=>i!=="category"&&d&&d.toString().toLowerCase().includes(e)))}return t}),I=S(null),M=()=>{I.value.click()},T=t=>{const e=t.target.files[0];if(!e)return;const a=new FileReader;e.name.endsWith(".csv")?(a.onload=i=>{const d=i.target.result,r=F(d);r&&(C.userList=r,t.target.value="")},a.readAsText(e)):e.name.endsWith(".json")?(a.onload=i=>{try{const d=JSON.parse(i.target.result);Array.isArray(d)?(C.userList=d,t.target.value=""):alert("Invalid JSON format. Expected an array.")}catch(d){alert("Error parsing JSON file: "+d.message)}},a.readAsText(e)):alert("Unsupported file format. Please upload CSV or JSON.")},F=t=>{try{const e=t.split(`
`).filter(c=>c.trim());if(e.length<2)return alert("CSV file is empty or has no data."),null;const a=e[0].split(",").map(c=>c.trim()),i=["name","employeeId","badgeId","locker","location","role","status"],d=i.filter(c=>!a.some(u=>u.toLowerCase()===c));if(d.length>0)return alert(`CSV file is missing required columns: ${d.join(", ")}`),null;const r=[];for(let c=1;c<e.length;c++){const u=e[c].split(","),L={};a.forEach((z,J)=>{var V;const U=z.toLowerCase();i.includes(U)&&(L[U]=((V=u[J])==null?void 0:V.trim())||"")}),r.push(L)}return r}catch(e){return alert("Error parsing CSV file: "+e.message),null}},R=()=>{const t=w.value,e=["name","employeeId","badgeId","locker","location","role","status"],a=[e.join(","),...t.map(c=>e.map(u=>c[u]||"").join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(i),r=document.createElement("a");r.setAttribute("href",d),r.setAttribute("download","users_export.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},q=()=>{k.push({name:"Users_all_edit",query:{mode:"add"}})},E=t=>{k.push({path:"/Users_all_edit",query:{mode:"edit",name:t.name,employeeId:t.employeeId,badgeId:t.badgeId,locker:t.locker,location:t.location,role:t.role,status:t.status,category:t.category||"",pin:t.pin||"",employmentStatus:t.employmentStatus||"active"}})},x=t=>{const a={Admin:"admin",Manager:"manager",Supervisor:"supervisor","Full Time":"fulltime",Temporary:"temp",Staff:"temp"}[t.role]||"temp",d={admin:"admin123",manager:"manager123",supervisor:"super123",fulltime:"full123",temp:"temp123"}[a];le.post("/php/login.php",{username:a,password:d}).then(r=>{const c=r.data;if(c&&c.code===0){const u=c.data;B.setAuth(u.username,u.role,u.token),Z.success("Logged in as "+u.role),k.push("/dashboard")}else alert("Login as user failed")}).catch(r=>{alert("Login as user failed: "+(r&&r.message))})};return(t,e)=>(g(),y("div",ae,[l("div",te,[l("h1",se,"Users ("+v(w.value.length)+")",1),l("div",oe,[o(s(P),{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"Search",style:{width:"200px"},clearable:""},null,8,["modelValue"]),o(s(m),{class:"import-btn",onClick:M},{default:n(()=>[...e[2]||(e[2]=[p(" Import File ",-1)])]),_:1}),o(s(m),{class:"export-btn",onClick:R},{default:n(()=>[...e[3]||(e[3]=[p(" Export File ",-1)])]),_:1}),o(s(m),{type:"primary",class:"add-user-btn",onClick:q},{default:n(()=>[...e[4]||(e[4]=[p("Add New User",-1)])]),_:1}),l("input",{ref_key:"fileInput",ref:I,type:"file",style:{display:"none"},accept:".csv,.json",onChange:T},null,544)])]),l("div",de,[o(s(Q),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a),placeholder:"All Categories",clearable:"",style:{width:"200px"}},{default:n(()=>[o(s(b),{label:"All Categories",value:""}),o(s(b),{label:"A1",value:"A1"}),o(s(b),{label:"A2",value:"A2"}),o(s(b),{label:"A3",value:"A3"}),o(s(b),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),(g(),K(s(Y),{key:t.refreshKey,data:w.value,"header-cell-style":D,class:"users-table desktop-table"},{default:n(()=>[o(s(f),{prop:"name",label:"Name"},{default:n(a=>[l("div",re,[(g(),y("svg",{class:j(["status-icon",a.row.employmentStatus==="active"?"status-active":"status-inactive"]),viewBox:"0 0 24 24",fill:"currentColor"},[...e[5]||(e[5]=[l("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])],2)),l("span",null,v(a.row.name),1)])]),_:1}),o(s(f),{prop:"employeeId",label:"Employee ID"}),o(s(f),{prop:"badgeId",label:"Badge ID"}),o(s(f),{label:"Locker / Location"},{default:n(a=>[l("div",ie,[l("div",null,v(a.row.locker),1),l("div",null,v(a.row.location),1)])]),_:1}),o(s(f),{prop:"role",label:"Role"}),o(s(f),{prop:"status",label:"Status"}),o(s(f),{label:"Operation",align:"center"},{default:n(a=>[o(s(m),{type:"primary",plain:"",class:"edit-btn",onClick:i=>E(a.row)},{default:n(()=>[...e[6]||(e[6]=[p(" Edit ",-1)])]),_:1},8,["onClick"]),o(s(m),{type:"success",plain:"",class:"login-as-btn",onClick:i=>x(a.row),style:{"margin-left":"8px"}},{default:n(()=>[...e[7]||(e[7]=[p(" Login As ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),l("div",ce,[(g(!0),y(G,null,X(w.value,(a,i)=>(g(),y("div",{key:i,class:"user-card"},[e[14]||(e[14]=A('<div class="card-row header-row-card" data-v-c57e0317><div class="card-cell" data-v-c57e0317><div class="cell-label" data-v-c57e0317>Name</div></div><div class="card-divider-vertical" data-v-c57e0317></div><div class="card-cell" data-v-c57e0317><div class="cell-label" data-v-c57e0317>Employee ID</div></div></div>',1)),l("div",ne,[l("div",ve,[l("div",ue,[(g(),y("svg",{class:j(["status-icon",a.employmentStatus==="active"?"status-active":"status-inactive"]),viewBox:"0 0 24 24",fill:"currentColor"},[...e[8]||(e[8]=[l("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])],2)),l("span",null,v(a.name),1)])]),e[9]||(e[9]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",pe,[l("div",me,v(a.employeeId),1)])]),e[15]||(e[15]=A('<div class="card-row header-row-card" data-v-c57e0317><div class="card-cell" data-v-c57e0317><div class="cell-label" data-v-c57e0317>Badge ID</div></div><div class="card-divider-vertical" data-v-c57e0317></div><div class="card-cell" data-v-c57e0317><div class="cell-label" data-v-c57e0317>Locker / Location</div></div></div>',1)),l("div",fe,[l("div",ge,[l("div",ye,v(a.badgeId),1)]),e[10]||(e[10]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",be,[l("div",he,[l("div",null,v(a.locker),1),l("div",null,v(a.location),1)])])]),e[16]||(e[16]=A('<div class="card-row header-row-card" data-v-c57e0317><div class="card-cell" data-v-c57e0317><div class="cell-label" data-v-c57e0317>Role</div></div><div class="card-divider-vertical" data-v-c57e0317></div><div class="card-cell" data-v-c57e0317><div class="cell-label" data-v-c57e0317>Status</div></div></div>',1)),l("div",_e,[l("div",we,[l("div",ke,v(a.role),1)]),e[11]||(e[11]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",Ce,[l("div",Se,v(a.status),1)])]),e[17]||(e[17]=l("div",{class:"card-row header-row-card"},[l("div",{class:"card-cell",style:{"grid-column":"1 / -1"}},[l("div",{class:"cell-label"},"Operation")])],-1)),l("div",Ae,[l("div",Ie,[l("div",Ee,[o(s(m),{type:"primary",plain:"",class:"edit-btn-mobile",onClick:d=>E(a)},{default:n(()=>[...e[12]||(e[12]=[p(" Edit ",-1)])]),_:1},8,["onClick"]),o(s(m),{type:"success",plain:"",class:"login-as-btn-mobile",onClick:d=>x(a),style:{"margin-left":"8px"}},{default:n(()=>[...e[13]||(e[13]=[p(" Login As ",-1)])]),_:1},8,["onClick"])])])])]))),128))])]))}}),je=$(xe,[["__scopeId","data-v-c57e0317"]]);export{je as default};
