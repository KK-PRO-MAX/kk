import{_ as z,v as H,r as k,g as $,c as w,b as m,e as a,t as p,u as n,d as l,l as K,w as c,f,j as v,E as g,h as M,F as X,p as G,O as L,x as J,n as S,k as P,W as Q,X as Y,A as Z}from"./index-DeY1YHTF.js";import{u as ee}from"./departmentStore-84bdMH_B.js";const te={class:"page-wrapper"},se={class:"header-row"},ae={class:"page-title"},ne={class:"header-actions"},le={class:"filter-section"},oe={class:"departments-grid"},de={class:"card-content"},re={class:"card-row-two-cols first-row"},ce={class:"left-section"},ie={class:"value"},ue={class:"right-section"},pe={class:"value"},me={class:"card-row-two-cols"},fe={class:"left-section"},ve={class:"bays-wrapper"},ge={class:"bays-first-line"},ye={key:0,class:"bays-expanded"},_e={class:"right-section"},he={class:"value-large"},xe={class:"button-row"},be={__name:"Departments",setup(we){const D=H(),d=ee(),y=k(""),_=k(""),T=$(()=>d.departments),N=s=>{const e=E.value[s],t=d.departments.findIndex(r=>r===e);t!==-1&&(d.departments[t].expanded=!d.departments[t].expanded)},A=s=>s?s.length>25:!1,F=s=>!s||s.length<=25?s:s.substring(0,25)+"...",E=$(()=>{let s=[...T.value];if(_.value&&(s=s.filter(e=>e.category===_.value)),y.value.trim()){const e=y.value.toLowerCase().trim();s=s.filter(t=>t.name.toLowerCase().includes(e)||t.assignedBays.includes(e)||t.devices.includes(e))}return s}),I=k(null),R=()=>{var s;(s=I.value)==null||s.click()},U=async s=>{const e=s.target.files[0];if(!e)return;const t=new FileReader;t.onload=r=>{var o,h,i,V;try{const C=r.target.result;if(e.name.endsWith(".csv")){const B=C.split(`
`),x=[];for(let u=1;u<B.length;u++)if(B[u].trim()){const b=B[u].split(",");x.push({name:((o=b[0])==null?void 0:o.trim())||"",assignedBays:((h=b[1])==null?void 0:h.trim())||"",devices:((i=b[2])==null?void 0:i.trim())||"",category:((V=b[3])==null?void 0:V.trim())||"A1"})}x.length>0&&(d.departments.length=0,x.forEach(u=>d.addDepartment(u)),alert(`成功导入 ${x.length} 条数据`))}else(e.name.endsWith(".xlsx")||e.name.endsWith(".xls"))&&alert("Excel 文件导入需要安装 xlsx 库。请使用 CSV 格式或安装 xlsx 库。")}catch(C){console.error("导入失败:",C),alert("文件导入失败，请检查文件格式")}},t.readAsText(e),s.target.value=""},W=()=>{const s="Department,Assigned Bays,Bays Total,Category",e=d.departments.map(i=>`${i.name},${i.assignedBays},${i.devices},${i.category}`),t=[s,...e].join(`
`),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),h=URL.createObjectURL(r);o.setAttribute("href",h),o.setAttribute("download",`departments_${new Date().getTime()}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),alert("数据导出成功")},j=()=>{D.push({path:"/Departments_all_edit",query:{mode:"add"}})},O=s=>{const e=d.departments.findIndex(t=>t===s);console.log("Editing department:",s),console.log("Department index:",e),D.push({path:"/Departments_all_edit",query:{mode:"edit",index:e}})},q=s=>{Z.confirm(`Are you sure you want to delete ${s.name}?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"confirm-delete-btn",cancelButtonClass:"cancel-delete-btn"}).then(()=>{const e=d.departments.findIndex(t=>t.name===s.name&&t.locker===s.locker&&t.assignedBays===s.assignedBays);e!==-1&&(d.deleteDepartment(e),alert("Department deleted successfully"))}).catch(()=>{console.log("Delete cancelled")})};return(s,e)=>(m(),w("div",te,[a("div",se,[a("h1",ae,"Departments ("+p(n(d).departments.length)+")",1),a("div",ne,[l(n(K),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"Search","prefix-icon":"el-icon-search",class:"search-input"},null,8,["modelValue"]),l(n(v),{class:"import-btn",onClick:R},{default:c(()=>[...e[2]||(e[2]=[f("Import File",-1)])]),_:1}),a("input",{ref_key:"fileInput",ref:I,type:"file",accept:".csv,.xlsx,.xls",style:{display:"none"},onChange:U},null,544),l(n(v),{class:"export-btn",onClick:W},{default:c(()=>[...e[3]||(e[3]=[f("Export File",-1)])]),_:1}),l(n(v),{type:"primary",class:"add-dept-btn",onClick:j},{default:c(()=>[...e[4]||(e[4]=[f("Add New Department",-1)])]),_:1})])]),a("div",le,[l(n(M),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),placeholder:"All Categories",clearable:"",style:{width:"200px"}},{default:c(()=>[l(n(g),{label:"All Categories",value:""}),l(n(g),{label:"A1",value:"A1"}),l(n(g),{label:"A2",value:"A2"}),l(n(g),{label:"A3",value:"A3"}),l(n(g),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),a("div",oe,[(m(!0),w(X,null,G(E.value,(t,r)=>(m(),w("div",{key:r,class:"dept-card-wrapper"},[l(n(Y),{class:"dept-card"},{default:c(()=>[a("div",de,[a("div",re,[a("div",ce,[e[5]||(e[5]=a("p",{class:"label"},"Department",-1)),a("p",ie,p(t.name),1)]),a("div",ue,[e[6]||(e[6]=a("p",{class:"label"},"Locker",-1)),a("p",pe,p(t.locker),1)])]),a("div",me,[a("div",fe,[e[7]||(e[7]=a("p",{class:"label"},"Assigned Bays",-1)),a("div",ve,[a("div",ge,[a("p",{class:S(["value bays-value",{expanded:t.expanded}])},p(t.expanded?t.assignedBays:F(t.assignedBays)),3),A(t.assignedBays)?(m(),J(n(P),{key:0,class:S(["expand-icon",{expanded:t.expanded}]),onClick:o=>N(r)},{default:c(()=>[l(n(Q))]),_:1},8,["class","onClick"])):L("",!0)]),t.expanded&&A(t.assignedBays)?(m(),w("div",ye,p(t.assignedBays),1)):L("",!0)])]),a("div",_e,[e[8]||(e[8]=a("p",{class:"label"},"Bays Total",-1)),a("p",he,p(t.devices),1)])]),a("div",xe,[l(n(v),{class:"edit-btn",onClick:o=>O(t,r)},{default:c(()=>[...e[9]||(e[9]=[f("Edit",-1)])]),_:1},8,["onClick"]),l(n(v),{class:"delete-btn",onClick:o=>q(t,r)},{default:c(()=>[...e[10]||(e[10]=[f("Delete",-1)])]),_:1},8,["onClick"])])])]),_:2},1024)]))),128))])]))}},ke=z(be,[["__scopeId","data-v-f3dd4682"]]);export{ke as default};
